---
layout: post
title:  Leetcode算法题 买卖股票的最佳时机 # 动态规划解法 # python
---

# 什么是动态规划？

https://www.zhihu.com/question/291280715 知乎的leetcode官方给的解释我觉得比较详细和全面。   

大体来讲就是将原问题划分为子问题， 然后 子问题的最优值是由更小规模的子问题的最优值 推导出来

比如这个买卖股票的问题

```
给定一个数组 prices ，它的第 i 个元素 prices[i] 表示一支给定股票第 i 天的价格。
你只能选择 某一天 买入这只股票，并选择在 未来的某一个不同的日子 卖出该股票。设计一个算法来计算你所能获取的最大利润。返回你可以从这笔交易中获取的最大利润。如果你不能获取任何利润，返回 0 。
```
问题是如何选定买入卖出才能让利润最大
那么这个问题可以怎么拆分呢？

我们怎么买卖才能让每一天的利润最大呢？

进一步进行拆分，我们每一天无非是 两种状态。 持有这只股票或者 不持有这支股票

所以在这里，我们可以生成两个子问题的最优值问题：
1. 我们在第i天持有这只股票，那么可以最大的利润是多少呢？
2. 如果我们在第i天抛出这支股票，那么可以获得的最大利润是多少呢？

进一步分析第一个子问题：
我什么时候买这只股票。
如果第i天的股票价格高于之前的价格，那么我不会选择去持有，因为这会让我的利润减小，那么我们最大利润取决于第i-1天持有的最大利润 
如果第i天的 股票价格低于之前的价格，那么我会选择持有，最大利润就是今天买股票的价格即  -price[i]

所以我第i天持有股票的最大利润是 max(-price[i], hold_i-1)

第二个子问题：
我什么时候卖这只股票：

一种情况是我选择在第i天卖出， 能获得的最大利润是 price[i]- hold_i-1
还有一种情况就是在第i天之前我卖掉了这只股票，能获得的最大利润是 unhold_i-1

我当然还是会选择利润最大的情况 max( price[i]- hold_i-1, unhold_i-1)

这样我们就成功的实现了对于这个问题的分解。

我们选择是不是应该在这一天买卖股票的依据是我在之前买/卖的利润更高还是今天更高。 
这样就保证了我们最终的卖出利润是最大的。因为每一天我都可以保证我的利润最大化。

另外这个题，为什么要分买卖两条线去求最大利润呢？
max 利润说白了它取决于 max(sell price - buy price)

如果存在一个更低的价格, 那么就可能会让我们的利润最低。所以我们需要keep eyes on the lower buy price
但是并不是只要一个价格是最低的我们就在这一点买入，事实上从第二天开始我们就已经开始计算卖出的利润了。
如果之后存在一个更低的买入点，但是经过计算在这一点之后的卖出点产生的利润一直没有我们之前的卖出利润大。
那么我们还是会选择之前的卖出点。


最后最后，贴代码
``` python 
# 买卖股票的最佳时机
class Solution(object):
    def maxProfit(self,prices):
        length=len(prices)
        i=1
        # 边界条件
        unhold=0
        hold = -prices[0]
        while i < length:
            # 转移方程
            unhold=max(unhold,hold+prices[i])
            hold=max(hold,-prices[i])
            i +=1 
        return unhold
```









